<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"/>
    <title>Sketch</title>
    <link rel="stylesheet" href="src/style.css">
    <style>
        /* Prevent native zoom and scrolling on the body */
        html, body {
            overflow: hidden !important;
            touch-action: pan-x pan-y;
            -webkit-overflow-scrolling: touch;
            margin: 0;
            padding: 0;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .app-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden !important;
        }

        /* Canvas viewport for pan and zoom */
        .canvas-viewport {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            background: #e0e0e0; 
        }

        .canvas-container {
            position: absolute;
            transform-origin: 0 0;
            will-change: transform;
        }

        #drawingCanvas {
            touch-action: none;
            cursor: move;
        }

        /* Ensure UI elements stay fixed during zoom */
        .top-controls {
            position: fixed !important;
            z-index: 1000;
        }

        .bottom-panel {
            position: fixed !important;
            z-index: 1000;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .mode-indicator {
            position: fixed !important;
            z-index: 500;
            top: 10px !important;
            left: 55px !important;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 8px;
            font-weight: 400;
            pointer-events: none;
            opacity: 0.7;
            letter-spacing: 0.3px;
            text-transform: uppercase;
            min-width: auto;
            white-space: nowrap;
            text-align: center;
        }

        #summaryLegend {
            position: fixed !important;
            z-index: 1000;
        }

        /* Styles for the new Photo Modal */
        #photoModal .modal-content {
            max-width: 95vw;
            width: 500px;
            max-height: 90vh;
        }
        #cameraContainer {
            position: relative;
            width: 100%;
            padding-top: 75%; /* 4:3 Aspect Ratio */
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        #cameraFeed {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #photoGallery {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
            min-height: 80px;
            border-top: 1px solid #eee;
            margin-top: 15px;
            padding-top: 15px;
        }
        .gallery-thumbnail {
            position: relative;
            flex-shrink: 0;
        }
        .gallery-thumbnail img {
            width: 100px;
            height: 75px;
            object-fit: cover;
            border-radius: 4px;
            border: 2px solid #ddd;
        }
        .gallery-delete-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            line-height: 20px;
            text-align: center;
            padding: 0;
        }

    </style>
</head>
<body>
    <div class="app-container">
        <!-- Mode indicator -->
        <div class="mode-indicator" id="modeIndicator">READY</div>

        <div class="canvas-viewport" id="canvasViewport">
            <div class="canvas-container" id="canvasContainer">
                <canvas id="drawingCanvas"></canvas>
            </div>
        </div>
        
        <div id="summaryLegend" class="hidden">
            <div><strong>Summary</strong></div>
            <div>Total GLA: <span id="legendGLA">0.0</span> sq ft</div>
            <div>Bedrooms: <span id="legendBedrooms">0</span></div>
            <div>Bathrooms: <span id="legendBathrooms">0</span></div>
            <div class="legend-list" id="legendGLABreakdown"></div>
            <div class="legend-section">Non-GLA Area: <span id="legendNonLiving">0.0</span> sq ft</div>
            <div class="legend-list" id="legendNonGLABreakdown"></div>
        </div>

        <!-- Icon Edit Controls -->
        <div class="icon-edit-controls hidden" id="iconEditControls">
            <div class="icon-edit-header">Edit Icon</div>
            <div class="edit-control-row">
                <div class="edit-control-label">Scale</div>
                <input type="range" class="edit-slider" id="scaleSlider" min="0.5" max="3" step="0.1" value="1">
                <div class="edit-value-display" id="scaleDisplay">1.0</div>
            </div>
            <div class="edit-control-row">
                <div class="edit-control-label">Width</div>
                <input type="range" class="edit-slider" id="widthSlider" min="0.5" max="3" step="0.1" value="1">
                <div class="edit-value-display" id="widthDisplay">1.0</div>
            </div>
            <div class="edit-control-row">
                <div class="edit-control-label">Height</div>
                <input type="range" class="edit-slider" id="heightSlider" min="0.5" max="3" step="0.1" value="1">
                <div class="edit-value-display" id="heightDisplay">1.0</div>
            </div>
            <div class="edit-control-row rotation-row">
                <div class="edit-control-label">Rotate</div>
                <input type="range" class="edit-slider" id="rotationSlider" min="0" max="7" step="1" value="0">
                <div class="edit-value-display" id="rotationDisplay">0°</div>
            </div>
            <div class="edit-control-buttons">
                <button class="edit-btn reset" id="resetIconBtn">Reset</button>
                <button class="edit-btn delete" id="deleteIconBtn">Delete</button>
                <button class="edit-btn done" id="doneEditingBtn">Done</button>
            </div>
        </div>

        <div class="top-controls">
            <button class="control-btn active" id="numbersBtn" data-palette="drawPalette">Numbers</button>
            <button class="control-btn" id="roomsBtn" data-palette="roomsPalette">Rooms</button>
            <button class="control-btn" id="iconsBtn" data-palette="iconsPalette">Icons</button>
            <button class="control-btn action-btn" id="startBtn">Start</button>
            <button class="control-btn action-btn" id="editBtn">Edit</button>
            <button class="control-btn hidden action-btn" id="relabelBtn">Relabel Area</button>
            <button class="control-btn hidden action-btn" id="labelEditBtn">Edit Label</button>
            <button class="control-btn hidden action-btn" id="labelDeleteBtn">Del Label</button>
            <button class="control-btn action-btn" id='undo'>Undo</button>
            <button class="control-btn action-btn" id="redo">Redo</button>
            <button class="control-btn finish-btn" id="legendToggleBtn">Legend</button>
            <button class="control-btn finish-btn">Preview</button>
            <button class="control-btn finish-btn">Import</button>
            <div class="export-dropdown">
                <button class="control-btn finish-btn">Save As</button>
                <div class="export-menu hidden" id="exportMenu">
                    <div class="export-option" id="saveAsBtn">New File</div>
                    <div class="export-option">JSON Data</div>
                    <div class="export-option">SVG Vector</div>
                    <div class="export-option">LaTeX/TikZ</div>
                    <div class="export-option">PNG</div>
                    <div class="export-option">PDF</div>
                </div>
            </div>
            <button class="control-btn finish-btn" id="photoBtn" data-palette="photoPalette">Photo</button>
            <button class="control-btn save-btn" id="saveBtn">Save</button>
            <div class="file-input-wrapper hidden">
                <input accept=".json" id="importFile" type="file"/>
            </div>
        </div>

        <div class="bottom-panel">
            <!-- Numbers Palette -->
            <div class="bottom-palette one-of-bottom-pallets" id="drawPalette">
                <div class="mobile-controls">
                  <div class="directional-pad" id="directionalPad">
                    <button class="dir-btn up">↑</button> <button class="dir-btn down">↓</button>
                    <button class="dir-btn left">←</button> <button class="dir-btn right">→</button>
                    <button class="dir-btn center">⬤</button> <button class="dir-btn up-left">↖</button>
                    <button class="dir-btn up-right">↗</button> <button class="dir-btn down-left">↙</button>
                    <button class="dir-btn down-right">↘</button>
                  </div>
                  <input class="angle-display draw-inputs hidden" id="angleDisplay" type="text" value="0"/>
                  <input class="distance-display draw-inputs" id="distanceDisplay" type="text" value="0"/>
                  <div class="numeric-keypad">
                    <button class="key-btn">1</button> <button class="key-btn">2</button>
                    <button class="key-btn">3</button> <button class="key-btn">4</button>
                    <button class="key-btn">5</button> <button class="key-btn">6</button>
                    <button class="key-btn">7</button> <button class="key-btn">8</button>
                    <button class="key-btn">9</button> <button class="key-btn">0</button>
                    <button class="key-btn secondary">del</button>
                    <button class="key-btn secondary" id='angle-btn'>angle</button>
                    <button class="key-btn secondary">clear</button>
                    <button class="key-btn close-btn">cls</button>
                  </div>
                </div>
            </div>
            
            <!-- Rooms Palette -->
            <div class="bottom-palette room-palette hidden one-of-bottom-pallets" id="roomsPalette">
                <div class="room-palette-label bedroom-palette">Bedroom</div>
                <div class="room-palette-label bedroom-palette">Bedroom.M</div>
                <div class="room-palette-label bath-palette">Bath</div>
                <div class="room-palette-label bath-palette">Bath.M</div>
                <div class="room-palette-label halfbath-palette">1/2 Bath</div>
                <div class="room-palette-label green-palette">Kitchen</div>
                <div class="room-palette-label green-palette">Kitchennette</div>
                <div class="room-palette-label green-palette">Living</div>
                <div class="room-palette-label green-palette">Dining</div>
                <div class="room-palette-label green-palette">Family</div>
                <div class="room-palette-label green-palette">Den</div>
                <div class="room-palette-label">Laundry</div>
                <div class="room-palette-label entry-palette">Entry</div>
                <div class="room-palette-label">Closet</div>
                <div class="room-palette-label">Office</div>
                <div class="room-palette-label">Garage</div>
                <div class="room-palette-label">Pantry</div>
                <div class="room-palette-label">Hallway</div>
                <div class="room-palette-label">Bar</div>
                <div class="room-palette-label">Addition</div>
                <div class="room-palette-label">SunRoom</div>
                <div class="room-palette-label">Covered Patio</div>
                <div class="room-palette-label">Covered Porch</div>
                <div class="room-palette-label">Uncovered Patio</div>
                <div class="room-palette-label">Uncovered Porch</div>
                <div class="room-palette-label perm-palette">Other</div>
            </div>
            
            <!-- Icons Palette -->
            <div class="bottom-palette icon-palette hidden one-of-bottom-pallets" id="iconsPalette">
                 <div class="icon-palette-item transparent-bg">
                    <img id="paletteIconDoor" alt="Door" width="45" height="45" src="public/door.svg" />
                </div>
            </div>

            <!-- Photo Palette -->
            <div class="bottom-palette hidden one-of-bottom-pallets" id="photoPalette">
                <!-- Content will be dynamically added by photo.js -->
            </div>



        </div>
    </div>

 

    <!-- Modals -->
    <div class="modal hidden" id="polygonModal">
        <!-- content... -->
    </div>

    <div class="modal hidden" id="lineEditModal">
        <!-- content... -->
    </div>

    <!-- NEW: Enhanced Photo Modal -->
    <div class="modal hidden" id="photoModal">
        <div class="modal-content">
            <h3 id="roomNameHeader" style="text-align: center; margin-bottom: 15px;">Photos for...</h3>
            
            <div id="cameraContainer">
                <video id="cameraFeed" autoplay playsinline></video>
                <canvas id="photoCaptureCanvas" class="hidden"></canvas>
            </div>

            <div id="photoGallery">
                <!-- Thumbnails will be rendered here by photo.js -->
            </div>
            
            <div class="modal-buttons" style="margin-top: auto; padding-top: 15px;">
                <button id="cancelPhotoBtn" class="modal-btn btn-secondary">Cancel</button>
                <button id="takePhotoBtn" class="modal-btn btn-primary" style="flex-grow: 1.5;">Take Photo</button>
                <button id="savePhotosBtn" class="modal-btn" style="background-color: #27ae60; color: white;">Save & Close</button>
            </div>
        </div>
    </div>

    <div class="type-context-menu hidden" id="typeContextMenu">
        <!-- content... -->
    </div>

    <div id="customCursor" class="hidden"></div>

    <div class="modal hidden" id="saveModal">
        <!-- content... -->
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>